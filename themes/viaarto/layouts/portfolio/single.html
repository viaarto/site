{{ define "main" }}

<section class="site-project-single-section">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <div class="site-project-single">
          <h1>
            {{ .Title }}
          </h1>
          <div class="site-project-single-description">
            {{ .Content }}
          </div>
          <div class="site-project-single-image">
            {{ range .Params.project_images }}
            <img src="{{ . | absURL }}" alt="project image">
            {{ end }}
          </div>
          {{/* Check if there's a previous or next project to show the action div */}}
          {{/* Link back - href will be set by JavaScript */}}
          <div class="site-project-single-action">
            {{/* Added id="voltar-link" and data-baseurl */}}
            <a href="#" id="voltar-link" class="home-portfolio-link" data-baseurl="{{ .Site.BaseURL | safeJS }}"> 
              <i class="fa fa-arrow-up"></i>
              <span class="link-area">
                <span data-text="Voltar">
                  Voltar
                </span>
              </span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{{ partial "call-to-action.html" . }}

{{/* Added JavaScript block */}}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const voltarLink = document.getElementById('voltar-link');;
    if (voltarLink) {
      const baseUrl = voltarLink.dataset.baseurl;; // Get base URL from data attribute
      let homeUrl = "";;
      if (baseUrl) {
        homeUrl = baseUrl.charAt(baseUrl.length - 1) === '/' ? baseUrl : baseUrl + '/';; // Ensure trailing slash for comparison
      }
      const referrer = document.referrer || "";; // Ensure referrer exists

      // Check if referrer is the homepage (or empty/different domain)
      if (referrer === homeUrl || !referrer.startsWith(baseUrl)) {
        // If came from homepage OR directly OR different site, link to homepage anchor
        voltarLink.href = "{{ "/" | relURL }}#project";;
      } else {
        // Otherwise (likely came from /portfolio/ or another internal page), link to portfolio list
        voltarLink.href = "{{ "portfolio/" | relURL }}";;
      }
    }
  });
</script>

{{ end }}
